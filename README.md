# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

## Архитектура и основные классы

### Используемый паттерн проектирования
В проекте применяется паттерн **MVC (Model-View-Controller)**:
- **Model** — управляет данными приложения (товары, корзина, заказ, пользовательские данные).
- **View** — отвечает за отображение данных и взаимодействие с пользователем (каталог, карточки, корзина, формы, модальные окна).
- **Controller** — координирует работу моделей и представлений, обрабатывает пользовательские действия и события.
- **Service** — вспомогательные классы для работы с API и событийной шины.

### Model

#### ProductModel
- **Задача:** Хранит список товаров, предоставляет методы поиска и фильтрации.
- **Поля:**
  - products — массив товаров.
- **Методы:**
  - setProducts(products) — сохранить список товаров.
  - getProductById(id) — получить товар по id.
  - filterByCategory(category) — фильтрация по категории.

#### BasketModel
- **Задача:** Хранит содержимое корзины.
- **Поля:**
  - items — массив товаров в корзине.
- **Методы:**
  - addItem(item) — добавить товар.
  - removeItem(productId) — удалить товар по id.
  - clear() — очистить корзину.
  - getTotal() — посчитать итоговую сумму.

#### OrderModel
- **Задача:** Хранит пользовательские данные для оформления заказа.
- **Поля:**
  - address — адрес доставки.
  - email — email пользователя.
  - phone — телефон пользователя.
  - payment — способ оплаты.
- **Методы:**
  - setAddress(address), setEmail(email), setPhone(phone), setPayment(payment) — установить значения.
  - clear() — очистить все поля.

### View

#### CatalogView
- **Задача:** Отображает список товаров, создает карточки товаров.
- **Поля:**
  - container — DOM-элемент каталога.
- **Методы:**
  - render(products) — отрисовать список товаров.
  - onProductClick(callback) — обработчик клика по товару.

#### ProductCardView
- **Задача:** Отображает отдельную карточку товара.
- **Поля:**
  - element — DOM-элемент карточки.
  - product — данные товара.
- **Методы:**
  - render(product) — отрисовать карточку.
  - setInBasket(isInBasket) — отметить товар в корзине.
  - onClick(callback) — обработчик клика.

#### BasketView
- **Задача:** Отображает содержимое корзины.
- **Поля:**
  - container — DOM-элемент корзины.
- **Методы:**
  - render(items) — отрисовать товары.
  - onRemove(callback) — обработчик удаления товара.
  - onCheckout(callback) — обработчик оформления заказа.

#### OrderFormView
- **Задача:** Отображает и валидирует форму заказа.
- **Поля:**
  - formElement — DOM-элемент формы.
- **Методы:**
  - render(orderData) — отрисовать форму.
  - validate() — валидация данных.
  - onSubmit(callback) — обработчик отправки.

#### ModalView
- **Задача:** Управляет модальными окнами.
- **Поля:**
  - modalElement — DOM-элемент окна.
- **Методы:**
  - open(content, title?) — открыть окно.
  - close() — закрыть окно.
  - setContent(content) — изменить содержимое.
  - setTitle(title) — изменить заголовок.

### Controller

#### AppController
- **Задача:** Управляет бизнес-логикой приложения, взаимодействует только с моделью (Model).
- **Поля:**
  - appData — экземпляр модели приложения (например, AppData).
- **Методы:**
  - addProduct(product) — добавляет товар в корзину через модель.
  - (другие методы для работы с моделью)
- Контроллер не взаимодействует с представлением напрямую и не описывает события. Все события инициируются и обрабатываются через EventEmitter в index.ts.

### Service

#### Api
- **Задача:** Взаимодействие с сервером.
- **Поля:**
  - baseUrl — адрес API.
- **Методы:**
  - get(uri) — GET-запрос.
  - post(uri, data, method) — POST/PUT/DELETE-запрос.
  - handleResponse(response) — обработка ответа.

#### EventEmitter
- **Задача:** Организация событийного взаимодействия между слоями.
- **Поля:**
  - _events — карта событий и подписчиков.
- **Методы:**
  - on(event, callback) — подписка на событие.
  - off(event, callback) — отписка.
  - emit(event, data) — генерация события.
  - onAll(callback) — подписка на все события.
  - offAll() — отписка от всех событий.
  - trigger(event, context) — генерация события с контекстом.

## Пользовательские события и взаимодействие слоёв

Взаимодействие между слоями реализуется через события, создаваемые и обрабатываемые с помощью класса EventEmitter.

**Примеры пользовательских событий:**
- `product:click` — пользователь кликнул по товару (инициируется в представлении, обрабатывается в контроллере).
- `basket:item-remove` — пользователь удалил товар из корзины (инициируется в BasketItemView).
- `order:open` — пользователь открыл оформление заказа.
- `order:submit` — пользователь отправил заказ.
- `modal:open` — открытие модального окна.
- `modal:close` — закрытие модального окна.

**Пример сценария взаимодействия:**
1. Пользователь кликает по кнопке "Добавить в корзину" в представлении товара. View инициирует событие 'basket:add' через EventEmitter.
2. В index.ts на событие 'basket:add' подписан контроллер, который вызывает метод addProduct(product) у модели.
3. Модель (например, AppData) после изменения данных инициирует событие 'basket:change' через EventEmitter.
4. На событие 'basket:change' подписан View (например, BasketView), который обновляет отображение корзины.

## Описание компонентов

- **Catalog** — отображает список товаров, использует `ProductCard` для каждого товара.
- **ProductCard** — отображает краткую информацию о товаре, открывает модальное окно с деталями по клику.
- **BasketView** — отображает выбранные товары, позволяет удалять товары и переходить к оформлению заказа.
- **Modal** — универсальное модальное окно для деталей товара и оформления заказа.
- **OrderForm** — форма для оформления заказа с валидацией.

## Типы данных
Все основные интерфейсы и типы определены в файле [`src/types/types.ts`](src/types/types.ts):
- Product, Order, UserContact, BasketItem и др.

