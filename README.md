# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

## Архитектура и основные классы

### Используемый паттерн проектирования
В проекте применяется паттерн **MVC (Model-View-Controller)**:
- **Model** — управляет данными приложения (товары, корзина, заказ, пользовательские данные).
- **View** — отвечает за отображение данных и взаимодействие с пользователем (каталог, карточки, корзина, формы, модальные окна).
- **Controller** — координирует работу моделей и представлений, обрабатывает пользовательские действия и события.
- **Service** — вспомогательные классы для работы с API и событийной шины.

### Model

#### ProductModel
- **Задача:** Хранит список товаров, предоставляет методы поиска и фильтрации.
- **Поля:**
  - products — массив товаров.
- **Методы:**
  - setProducts(products) — сохранить список товаров.
  - getProductById(id) — получить товар по id.
  - filterByCategory(category) — фильтрация по категории.

#### BasketModel
- **Задача:** Хранит содержимое корзины.
- **Поля:**
  - items — массив товаров в корзине.
- **Методы:**
  - addItem(item) — добавить товар.
  - removeItem(productId) — удалить товар по id.
  - clear() — очистить корзину.
  - getTotal() — посчитать итоговую сумму.

#### OrderModel
- **Задача:** Хранит пользовательские данные для оформления заказа.
- **Поля:**
  - address — адрес доставки.
  - email — email пользователя.
  - phone — телефон пользователя.
  - payment — способ оплаты.
- **Методы:**
  - setAddress(address), setEmail(email), setPhone(phone), setPayment(payment) — установить значения.
  - clear() — очистить все поля.

### View

#### CatalogView
- **Задача:** Отображает список товаров, создает карточки товаров.
- **Поля:**
  - container — DOM-элемент каталога.
  - events — экземпляр EventEmitter.
- **Методы:**
  - render(products) — отрисовать список товаров. Данные для отображения всегда передаются в метод как аргумент.
- При клике по товару инициирует событие 'product:click' через EventEmitter.

#### ProductCardView
- **Задача:** Отображает отдельную карточку товара.
- **Поля:**
  - element — DOM-элемент карточки.
  - events — экземпляр EventEmitter.
- **Методы:**
  - render(product, isInBasket) — отрисовать карточку товара с учётом состояния (например, выделить, если товар в корзине). Данные для отображения всегда передаются в метод как аргументы. View не хранит и не меняет состояние товара.
- При клике по карточке инициирует событие 'product:click' через EventEmitter. Обработка этого события происходит вне View (например, в контроллере).

#### BasketView
- **Задача:** Отображает содержимое корзины.
- **Поля:**
  - container — DOM-элемент корзины.
  - events — экземпляр EventEmitter.
- **Методы:**
  - render(items) — отрисовать список BasketItemView. Данные для отображения всегда передаются в метод как аргумент.
- Для каждого товара отображает отдельный BasketItemView.
- Оформление заказа инициирует событие 'order:open' через EventEmitter.

#### BasketItemView
- **Задача:** Отображает отдельный товар в корзине.
- **Поля:**
  - element — DOM-элемент товара.
  - events — экземпляр EventEmitter.
- **Методы:**
  - render(item) — отрисовать товар. Данные для отображения всегда передаются в метод как аргумент.
- При клике на кнопку удаления инициирует событие 'basket:item-remove' через EventEmitter.

#### OrderFormView
- **Задача:** Отображает форму заказа и ошибки валидации.
- **Поля:**
  - formElement — DOM-элемент формы.
  - events — экземпляр EventEmitter.
- **Методы:**
  - render(orderData, errors) — отрисовать форму с учётом ошибок валидации. Данные для отображения и объект ошибок всегда передаются в метод как аргументы.
- При отправке формы инициирует событие 'order:submit' через EventEmitter.

#### ModalView
- **Задача:** Управляет модальными окнами.
- **Поля:**
  - modalElement — DOM-элемент окна.
  - events — экземпляр EventEmitter.
- **Методы:**
  - open(content, title?) — открыть окно.
  - close() — закрыть окно.
  - setContent(content) — изменить содержимое.
  - setTitle(title) — изменить заголовок.
- При открытии и закрытии инициирует события 'modal:open' и 'modal:close' через EventEmitter.

## Пользовательские события и взаимодействие слоёв

Взаимодействие между слоями реализуется через события, создаваемые и обрабатываемые с помощью класса EventEmitter.

**Примеры пользовательских событий, инициируемых представлениями:**
- `product:click` — пользователь кликнул по товару (инициируется в ProductCardView/CatalogView, обрабатывается в контроллере).
- `basket:item-remove` — пользователь удалил товар из корзины (инициируется в BasketItemView).
- `order:open` — пользователь открыл оформление заказа (инициируется в BasketView).
- `order:submit` — пользователь отправил заказ (инициируется в OrderFormView).
- `modal:open` — открытие модального окна (инициируется в ModalView).
- `modal:close` — закрытие модального окна (инициируется в ModalView).

**Пример сценария взаимодействия:**
1. Пользователь кликает по кнопке "Добавить в корзину" в представлении товара. View инициирует событие 'basket:add' через EventEmitter.
2. В index.ts на событие 'basket:add' подписан контроллер, который вызывает метод addProduct(product) у модели.
3. Модель (например, AppData) после изменения данных инициирует событие 'basket:change' через EventEmitter.
4. На событие 'basket:change' подписан View (например, BasketView), который обновляет отображение корзины.

## Описание компонентов

- **Catalog** — отображает список товаров, использует `ProductCard` для каждого товара.
- **ProductCard** — отображает краткую информацию о товаре, открывает модальное окно с деталями по клику.
- **BasketView** — отображает выбранные товары, позволяет удалять товары и переходить к оформлению заказа.
- **Modal** — универсальное модальное окно для деталей товара и оформления заказа.
- **OrderForm** — форма для оформления заказа с валидацией.

## Типы данных
Все основные интерфейсы и типы определены в файле [`src/types/types.ts`](src/types/types.ts):
- Product, Order, UserContact, BasketItem и др.

